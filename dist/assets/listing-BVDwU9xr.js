import{d as J,q as Q,b as $,z as i,u as G,a as H,f as W,r as f,i as X,j as e,t as S,p as Y,h as A,x as Z,S as ee}from"./index-CMbjzSXO.js";import{C as te}from"./confirm-booking-payment-zrejkqYx.js";import{F as se,I as E,S as h,T as re}from"./get-countries-D00X0R5n.js";import{F as k}from"./get-listings-DRrhn1kK.js";import{u as ne,B as ae}from"./get-category-D_4z0seI.js";import{u as ie,a as oe,C as le,F as ce,M as ue,A as me}from"./add-listing-BXms6dGN.js";import{M as U,C as M}from"./modal-ByhjIqyQ.js";import{d as de,e as pe,c as ge}from"./get-states-CxLu8I-w.js";import{u as fe,c as xe}from"./create-uploads-Bg8sag3Z.js";import"./get-reviews-D6hE6ck7.js";import"./index-Cucp_3aN.js";const ye=({listingId:n})=>$.get(`/listing/${n}`),T=n=>Q({queryKey:["listings",n],queryFn:()=>ye({listingId:n})}),w=({listingId:n,queryConfig:r})=>J({...T(n),...r}),he=i.object({category_id:i.string({required_error:"category is required"}),name:i.string({required_error:"name is required"}),listing_type:i.string(),price:i.string({required_error:"price is required"}),discount:i.number().optional(),qty:i.number().optional(),cycle:i.string(),description:i.string({required_error:"description is required"}),address_id:i.string(),listing_images:i.array(i.string()).optional(),listing_features:i.object({name:i.string(),value:i.string().or(i.number())}).array().optional()}),be=({data:n,listingId:r})=>$.patch(`/listing/${r}`,n),je=({mutationConfig:n}={})=>{const r=G(),{onSuccess:c,...m}=n||{};return H({onSuccess:(p,...g)=>{r.refetchQueries({queryKey:T(p.id).queryKey}),c==null||c(p,...g)},...m,mutationFn:be})},Ne=({listingId:n})=>{var F,q,O;const{addNotification:r}=W(),[c,m]=f.useState(!1),[p,g]=f.useState(!1),[b,V]=f.useState([]),[_,j]=f.useState([]),z=fe(),N=w({listingId:n}),D=X(),{counters:C,addCounter:P,updateCounter:K,deleteCounter:R}=ie(),L=ne({}),x=oe({}),v=(F=L==null?void 0:L.data)==null?void 0:F.data,y=(q=x==null?void 0:x.data)==null?void 0:q.data,I=je({mutationConfig:{onSuccess:()=>{r({type:"success",title:"success",message:"Listing Updated Successfully"}),D(Y.app.owner.myListings.getHref())},onError:a=>{const l=A(a);r({type:"error",title:"Validation Error",message:l})}}}),B=async()=>{const a=b.filter(o=>!o.url).map(o=>o.originFileObj),l=xe.parse({document:a});b.length>0&&z.mutate({data:l},{onSuccess(o){var d;r({type:"success",title:"Success",message:"File uploaded successfully"});const t=(d=o==null?void 0:o.data)==null?void 0:d.url,u=[..._,t];j(u),localStorage.setItem("uploadedImages",JSON.stringify(u))},onError(o){const t=A(o);r({type:"error",title:"Validation Error",message:t})}})};f.useEffect(()=>{const a=localStorage.getItem("uploadedImages");a&&j(JSON.parse(a))},[j]);const s=(O=N==null?void 0:N.data)==null?void 0:O.data;return e.jsxs(e.Fragment,{children:[e.jsx(se,{onSubmit:async a=>{await B();const l=C.map(t=>({name:t.label,value:t.count})),o={...a,listing_features:l,listing_images:_};I.mutate({data:o,listingId:n})},className:"flex flex-col",options:{defaultValues:{name:(s==null?void 0:s.name)??"",category_id:(s==null?void 0:s.category_id)??"",listing_type:(s==null?void 0:s.listing_type)??"",cycle:(s==null?void 0:s.cycle)??"",price:(s==null?void 0:s.price)??"",address_id:(s==null?void 0:s.address_id)??"",description:(s==null?void 0:s.description)??"",listing_features:(s==null?void 0:s.listing_features)||[]}},schema:he,children:({register:a,formState:l})=>{var o;return e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"block h-[3.2rem] w-full rounded-md bg-light px-3 py-3 outline-none focus:outline-none md:w-[70%]",type:"text",label:"Name/Title of Listing",placeholder:"",error:l.errors.name,registration:a("name")}),e.jsx(h,{label:"Listing Category",className:"block h-[3.2rem] w-full rounded-md bg-light px-3 py-3 outline-none focus:outline-none md:w-[70%]",error:l.errors.category_id,registration:a("category_id"),defaultValue:((o=s==null?void 0:s.category)==null?void 0:o.name)||"",options:v?v.map(t=>({label:t==null?void 0:t.name,value:t==null?void 0:t.id})):[]}),e.jsx(h,{className:"block h-[3.2rem] w-full rounded-md bg-light px-3 py-3 outline-none focus:outline-none md:w-[70%]",label:"Listing Type",error:l.errors.listing_type,registration:a("listing_type"),options:de.map(t=>({label:t.label,value:t.value}))}),e.jsxs("div",{className:"grid w-full grid-cols-2 gap-x-[1.5rem] md:w-[70%]",children:[e.jsx(h,{className:"block h-[3.2rem] w-full rounded-md bg-light px-3 py-3 outline-none focus:outline-none",label:"Listing Cycle",error:l.errors.cycle,registration:a("cycle"),options:pe.map(t=>({label:t.label,value:t.value}))}),e.jsx(E,{className:"block h-[3.2rem] w-full rounded-md bg-light px-3 py-3 outline-none focus:outline-none",type:"number",label:`Price (${ge})`,placeholder:"Enter Price",error:l.errors.price,registration:a("price")})]}),e.jsxs("div",{className:"relative w-full md:w-[70%]",children:[e.jsx(h,{label:"Listing Address",className:"block h-[3.2rem] w-full rounded-md bg-light px-3 py-3 outline-none focus:outline-none",error:l.errors.address_id,registration:a("address_id"),options:x.isLoading||!y?[]:y==null?void 0:y.map(t=>{var u,d;return{label:`${t.street_no} ${t==null?void 0:t.location} ${t.city}, ${t==null?void 0:t.zip_code}, ${(u=t==null?void 0:t.state)==null?void 0:u.name} ,${(d=t==null?void 0:t.country)==null?void 0:d.name}  `,value:t==null?void 0:t.id}})}),e.jsx(k,{icon:S,className:"absolute left-28 top-1 cursor-pointer text-primary",onClick:()=>g(!0)})]}),e.jsx("div",{className:"w-full md:w-[70%]",children:e.jsx(re,{label:"Listing Description",className:"bg-light",error:l.errors.description,registration:a("description")})}),e.jsxs("div",{className:"flex w-full flex-col gap-x-[1.5rem] md:flex-row",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("p",{className:"mb-1 font-lato text-[0.96rem] font-bold leading-[1.1rem] tracking-[0.03em] text-secondary",children:"Listing Features"}),e.jsx(k,{icon:S,className:"cursor-pointer text-primary",onClick:()=>m(!0)})]}),C.map((t,u)=>e.jsx(le,{label:t.label,count:t.count,setCount:d=>K(u,d),onDeleteCounter:()=>R(u)},u))]}),e.jsxs("div",{className:"",children:[e.jsx("p",{className:"mb-1 font-lato text-[0.96rem] font-bold leading-[1.1rem] tracking-[0.03em] text-secondary",children:"Listing Images"}),e.jsx("div",{children:e.jsx(ce,{fileList:b,setFileList:V})})]})]}),e.jsx("div",{className:"",children:e.jsx(ae,{isLoading:I.isPending,className:"h-[3.4rem] rounded-[0.67rem] bg-primary px-[1.5rem] font-lato text-[1.8rem] font-bold capitalize leading-[2.1rem] tracking-[0.03em] text-white disabled:opacity-0",children:"Update"})})]})}}),e.jsx(U,{IsOpen:c,setIsOpen:m,children:e.jsx(ue,{IsOpen:c,setIsOpen:m,onAddCounter:P})}),e.jsx(U,{IsOpen:p,setIsOpen:g,children:e.jsx(me,{IsOpen:p,setIsOpen:g})})]})},Le=({listingId:n})=>{var m;const r=w({listingId:n});r.isLoading;const c=(m=r==null?void 0:r.data)==null?void 0:m.data;return!c||(c==null?void 0:c.length)===0?e.jsx(M,{children:e.jsx("p",{children:"No Listing Available"})}):e.jsx(e.Fragment,{children:e.jsx(Ne,{listingId:n})})},ke=()=>{const r=Z().listingId;return w({listingId:r}).isLoading?e.jsx("div",{className:"flex h-48 w-full items-center justify-center",children:e.jsx(ee,{size:"lg"})}):e.jsx(te,{title:"Edit Listing",children:e.jsx(M,{className:"mb-20 mt-2 h-full w-full border bg-white shadow-md",children:e.jsx(Le,{listingId:r})})})};export{ke as ListingRoute};
